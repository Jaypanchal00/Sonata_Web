<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Confirmation - Sonata</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .confirmation-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #28a745;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }
        .confirmation-icon i {
            font-size: 40px;
            color: white;
        }
        .order-timeline {
            position: relative;
            padding-left: 30px;
        }
        .order-timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #dee2e6;
        }
        .timeline-item {
            position: relative;
            padding-bottom: 20px;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -34px;
            top: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #28a745;
            border: 2px solid white;
        }
        .timeline-item.pending::before {
            background-color: #ffc107;
        }
        .timeline-item.future::before {
            background-color: #dee2e6;
        }
        .product-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .tracking-number {
            font-family: monospace;
            letter-spacing: 1px;
        }
        .share-buttons .btn {
            width: 40px;
            height: 40px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin: 0 5px;
        }
        .order-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        .order-item:last-child {
            border-bottom: none;
        }
        .order-item-image {
            width: 80px;
            height: 80px;
            margin-right: 15px;
            position: relative;
            background-color: #f8f9fa;
            border-radius: 8px;
            overflow: hidden;
        }
        .order-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .order-item-details {
            flex: 1;
        }
        .order-item-name {
            font-weight: 500;
            margin-bottom: 5px;
        }
        .order-item-price {
            color: #28a745;
            font-weight: 500;
        }
        .order-item-quantity {
            color: #6c757d;
            font-size: 0.9rem;
        }
        .image-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg bg-white shadow-sm px-4 py-2">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
                <img src="https://www.sonatawatches.in/on/demandware.static/-/Library-Sites-SonataSharedLibrary/default/dw03b590d6/images/sonataLogo.svg"
                    alt="Sonata Logo" class="navbar-logo" style="height: 30px; width: auto;" />
            </a>
            <div class="top-icons d-flex align-items-center ms-auto gap-3">
                <a href="login.html" class="text-dark text-decoration-none">
                    <i class="bi bi-person fs-5"></i>
                </a>
                <a href="wishlist.html" class="text-dark text-decoration-none">
                    <i class="bi bi-heart fs-5"></i>
                </a>
                <a href="cart.html" class="text-dark text-decoration-none position-relative">
                    <i class="bi bi-bag fs-5"></i>
                    <span class="cart-count" id="cartCount">0</span>
                </a>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        <div class="row justify-content-center">
            <div class="col-md-8 text-center">
                <div class="confirmation-icon">
                    <i class="bi bi-check-lg"></i>
                </div>
                <h2 class="mb-3">Order Confirmed!</h2>
                <p class="text-muted mb-4">Thank you for your purchase. Your order has been successfully placed.</p>
                
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0">Order #<span id="orderNumber">123456</span></h5>
                            <span class="badge bg-success">Confirmed</span>
                        </div>
                        <p class="text-muted mb-0">Placed on <span id="orderDate">May 15, 2024</span></p>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-4">Order Timeline</h5>
                        <div class="order-timeline">
                            <div class="timeline-item">
                                <h6 class="mb-1">Order Placed</h6>
                                <p class="text-muted mb-0">Your order has been received</p>
                                <small class="text-muted">Today, 2:30 PM</small>
                            </div>
                            <div class="timeline-item pending">
                                <h6 class="mb-1">Processing</h6>
                                <p class="text-muted mb-0">We're preparing your order</p>
                            </div>
                            <div class="timeline-item future">
                                <h6 class="mb-1">Shipped</h6>
                                <p class="text-muted mb-0">Your order is on its way</p>
                            </div>
                            <div class="timeline-item future">
                                <h6 class="mb-1">Delivered</h6>
                                <p class="text-muted mb-0">Expected delivery date</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-4">Order Details</h5>
                        <div id="orderItems">
                            <!-- Order items will be dynamically added here -->
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Subtotal</span>
                            <span id="subtotal">₹0</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Shipping</span>
                            <span id="shipping">Free</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Tax</span>
                            <span id="tax">₹0</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2" id="promoDiscount" style="display: none;">
                            <span>Promo Discount</span>
                            <span class="text-success" id="discountAmount">-₹0</span>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between">
                            <strong>Total</strong>
                            <strong id="total">₹0</strong>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-4">Shipping Information</h5>
                        <div class="p-3 bg-light rounded">
                            <div class="d-flex align-items-center mb-3">
                                <i class="bi bi-person-circle fs-4 me-2 text-primary"></i>
                                <div>
                                    <h6 class="mb-1" id="shippingName"></h6>
                                    <small class="text-muted" id="shippingEmail"></small>
                                </div>
                            </div>
                            <div class="d-flex align-items-center mb-3">
                                <i class="bi bi-geo-alt fs-4 me-2 text-primary"></i>
                                <div>
                                    <p class="mb-1" id="shippingAddress1"></p>
                                    <p class="mb-1" id="shippingAddress2"></p>
                                </div>
                            </div>
                            <div class="d-flex align-items-center">
                                <i class="bi bi-telephone fs-4 me-2 text-primary"></i>
                                <div>
                                    <p class="mb-0" id="shippingPhone"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-4">Tracking Information</h5>
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            Your tracking number will be available once your order is shipped.
                        </div>
                        <div class="d-flex align-items-center justify-content-center">
                            <i class="bi bi-truck me-2"></i>
                            <span class="tracking-number">TRK123456789</span>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-4">Share Your Purchase</h5>
                        <div class="share-buttons d-flex justify-content-center">
                            <button class="btn btn-primary">
                                <i class="bi bi-facebook"></i>
                            </button>
                            <button class="btn btn-info text-white">
                                <i class="bi bi-twitter"></i>
                            </button>
                            <button class="btn btn-success">
                                <i class="bi bi-whatsapp"></i>
                            </button>
                            <button class="btn btn-danger">
                                <i class="bi bi-instagram"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="d-grid gap-2">
                    <a href="index.html" class="btn btn-dark">
                        <i class="bi bi-house-door me-2"></i>Continue Shopping
                    </a>
                    <a href="#" class="btn btn-outline-dark">
                        <i class="bi bi-download me-2"></i>Download Invoice
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Add image cache
        const imageCache = new Map();
        
        // Function to fetch image with retry mechanism
        async function fetchImage(url, retries = 2) {
            // Check cache first
            if (imageCache.has(url)) {
                return imageCache.get(url);
            }
            
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('Image fetch failed');
                
                // Convert to blob and create object URL
                const blob = await response.blob();
                const objectUrl = URL.createObjectURL(blob);
                
                // Cache the result
                imageCache.set(url, objectUrl);
                return objectUrl;
            } catch (error) {
                if (retries > 0) {
                    // Retry with exponential backoff
                    await new Promise(resolve => setTimeout(resolve, 1000 * (3 - retries)));
                    return fetchImage(url, retries - 1);
                }
                throw error;
            }
        }

        // Function to get product image URL
        function getProductImageUrl(item) {
            // Try direct image URL first
            if (item.image) {
                return item.image;
            }
            
            // Try to construct from product ID
            if (item.id) {
                return `https://www.sonatawatches.in/dw/image/v2/BKDD_PRD/on/demandware.static/-/Sites-sonata-master-catalog/default/dw3b590d6/images/${item.id}.png`;
            }
            
            // Try to construct from product name
            if (item.name) {
                const productId = item.name.toLowerCase()
                    .replace(/\s+/g, '-')
                    .replace(/[^a-z0-9-]/g, '');
                return `https://www.sonatawatches.in/dw/image/v2/BKDD_PRD/on/demandware.static/-/Sites-sonata-master-catalog/default/dw3b590d6/images/${productId}.png`;
            }
            
            // Return placeholder as last resort
            return 'https://www.sonatawatches.in/dw/image/v2/BKDD_PRD/on/demandware.static/-/Sites-sonata-master-catalog/default/dw3b590d6/images/placeholder.png';
        }

        // Error handling function
        function handleError(message) {
            console.error(message);
            const errorDiv = document.createElement('div');
            errorDiv.className = 'alert alert-danger mt-3';
            errorDiv.innerHTML = `
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                ${message}
            `;
            document.querySelector('.container').insertBefore(errorDiv, document.querySelector('.row'));
        }

        // Validate order data
        function validateOrderData(orderData) {
            if (!orderData) {
                handleError('No order data found. Please try again.');
                return false;
            }

            if (!orderData.items || !Array.isArray(orderData.items) || orderData.items.length === 0) {
                handleError('No items found in the order.');
                return false;
            }

            if (!orderData.shipping) {
                handleError('Shipping information is missing.');
                return false;
            }

            if (!orderData.payment) {
                handleError('Payment information is missing.');
                return false;
            }

            return true;
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        // Generate random order number
        function generateOrderNumber() {
            return Math.floor(100000 + Math.random() * 900000);
        }

        // Format date
        function formatDate(date) {
            try {
                const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                return date.toLocaleDateString('en-US', options);
            } catch (error) {
                console.error('Date formatting error:', error);
                return 'Date not available';
            }
        }

        // Generate invoice PDF
        function generateInvoice() {
            try {
                const orderData = JSON.parse(localStorage.getItem('orderData')) || {};
                if (!orderData || !orderData.shipping) {
                    handleError('No order data found to generate invoice.');
                    return;
                }

                // Create invoice content
                let invoiceContent = `
                    <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px;">
                        <div style="text-align: center; margin-bottom: 30px;">
                            <img src="https://www.sonatawatches.in/on/demandware.static/-/Library-Sites-SonataSharedLibrary/default/dw03b590d6/images/sonataLogo.svg" 
                                 alt="Sonata Logo" style="height: 40px; margin-bottom: 20px;">
                            <h2>INVOICE</h2>
                            <p>Order #${orderData.orderNumber || generateOrderNumber()}</p>
                            <p>Date: ${orderData.orderDate || formatDate(new Date())}</p>
                        </div>

                        <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
                            <div>
                                <h3>Billing Details</h3>
                                <p>${orderData.shipping.firstName} ${orderData.shipping.lastName}</p>
                                <p>${orderData.shipping.address1}</p>
                                ${orderData.shipping.address2 ? `<p>${orderData.shipping.address2}</p>` : ''}
                                <p>${orderData.shipping.city}, ${orderData.shipping.state} ${orderData.shipping.postalCode}</p>
                                <p>Phone: +91 ${orderData.shipping.phone}</p>
                                ${orderData.shipping.email ? `<p>Email: ${orderData.shipping.email}</p>` : ''}
                            </div>
                            <div>
                                <h3>Payment Details</h3>
                                <p>Payment Method: ${orderData.payment ? orderData.payment.method : 'Not specified'}</p>
                                <p>Status: Paid</p>
                                ${orderData.payment && orderData.payment.transactionId ? 
                                    `<p>Transaction ID: ${orderData.payment.transactionId}</p>` : ''}
                            </div>
                        </div>

                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
                            <thead>
                                <tr style="background-color: #f8f9fa;">
                                    <th style="padding: 10px; text-align: left; border-bottom: 1px solid #dee2e6;">Item</th>
                                    <th style="padding: 10px; text-align: right; border-bottom: 1px solid #dee2e6;">Quantity</th>
                                    <th style="padding: 10px; text-align: right; border-bottom: 1px solid #dee2e6;">Price</th>
                                    <th style="padding: 10px; text-align: right; border-bottom: 1px solid #dee2e6;">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                // Add order items
                if (orderData.items && orderData.items.length > 0) {
                    orderData.items.forEach(item => {
                        invoiceContent += `
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">${item.name}</td>
                                <td style="padding: 10px; text-align: right; border-bottom: 1px solid #dee2e6;">${item.quantity}</td>
                                <td style="padding: 10px; text-align: right; border-bottom: 1px solid #dee2e6;">${formatCurrency(item.price)}</td>
                                <td style="padding: 10px; text-align: right; border-bottom: 1px solid #dee2e6;">${formatCurrency(item.price * item.quantity)}</td>
                            </tr>
                        `;
                    });
                }

                // Add totals
                invoiceContent += `
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="3" style="padding: 10px; text-align: right; border-top: 2px solid #dee2e6;">Subtotal</td>
                                    <td style="padding: 10px; text-align: right; border-top: 2px solid #dee2e6;">${formatCurrency(orderData.summary.subtotal)}</td>
                                </tr>
                                <tr>
                                    <td colspan="3" style="padding: 10px; text-align: right;">Shipping</td>
                                    <td style="padding: 10px; text-align: right;">${orderData.summary.shipping === 0 ? 'Free' : formatCurrency(orderData.summary.shipping)}</td>
                                </tr>
                                <tr>
                                    <td colspan="3" style="padding: 10px; text-align: right;">Tax</td>
                                    <td style="padding: 10px; text-align: right;">${formatCurrency(orderData.summary.tax)}</td>
                                </tr>
                                ${orderData.summary.discount > 0 ? `
                                <tr>
                                    <td colspan="3" style="padding: 10px; text-align: right;">Discount</td>
                                    <td style="padding: 10px; text-align: right; color: #28a745;">-${formatCurrency(orderData.summary.discount)}</td>
                                </tr>
                                ` : ''}
                                <tr>
                                    <td colspan="3" style="padding: 10px; text-align: right; font-weight: bold;">Total</td>
                                    <td style="padding: 10px; text-align: right; font-weight: bold;">${formatCurrency(orderData.summary.total)}</td>
                                </tr>
                            </tfoot>
                        </table>

                        <div style="text-align: center; margin-top: 50px; color: #6c757d; font-size: 12px;">
                            <p>Thank you for your purchase!</p>
                            <p>This is a computer-generated invoice and does not require a signature.</p>
                        </div>
                    </div>
                `;

                // Create PDF
                const element = document.createElement('div');
                element.innerHTML = invoiceContent;
                
                // Use html2pdf library to generate PDF
                const opt = {
                    margin: 1,
                    filename: `Sonata_Invoice_${orderData.orderNumber || generateOrderNumber()}.pdf`,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
                };

                // Add html2pdf library
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js';
                script.onload = function() {
                    html2pdf().set(opt).from(element).save();
                };
                document.head.appendChild(script);
            } catch (error) {
                handleError('Error generating invoice. Please try again.');
                console.error('Invoice generation error:', error);
            }
        }

        // Update order details with improved image handling
        async function updateOrderDetails() {
            try {
                // Get order data from localStorage
                const orderData = JSON.parse(localStorage.getItem('orderData')) || {};
                
                // Validate order data
                if (!validateOrderData(orderData)) {
                    return;
                }

                // Set order number and date
                document.getElementById('orderNumber').textContent = orderData.orderNumber || generateOrderNumber();
                document.getElementById('orderDate').textContent = orderData.orderDate ? formatDate(new Date(orderData.orderDate)) : formatDate(new Date());
                
                // Update shipping information
                if (orderData.shipping) {
                    try {
                        if (orderData.shipping.firstName && orderData.shipping.lastName) {
                            document.getElementById('shippingName').textContent = 
                                `${orderData.shipping.firstName} ${orderData.shipping.lastName}`;
                        }
                        
                        if (orderData.shipping.email) {
                            document.getElementById('shippingEmail').textContent = orderData.shipping.email;
                        }

                        if (orderData.shipping.address1) {
                            document.getElementById('shippingAddress1').textContent = orderData.shipping.address1;
                        }
                        
                        let addressLine2 = '';
                        if (orderData.shipping.address2) {
                            addressLine2 += orderData.shipping.address2 + ', ';
                        }
                        if (orderData.shipping.city && orderData.shipping.state && orderData.shipping.postalCode) {
                            addressLine2 += `${orderData.shipping.city}, ${orderData.shipping.state} ${orderData.shipping.postalCode}`;
                            document.getElementById('shippingAddress2').textContent = addressLine2;
                        }

                        if (orderData.shipping.phone) {
                            document.getElementById('shippingPhone').textContent = 
                                `Phone: +91 ${orderData.shipping.phone}`;
                        }
                    } catch (error) {
                        handleError('Error displaying shipping information.');
                    }
                }
                
                // Update order items with improved image handling
                const orderItems = document.getElementById('orderItems');
                orderItems.innerHTML = '';
                
                if (orderData.items && orderData.items.length > 0) {
                    for (const item of orderData.items) {
                        try {
                            const itemDiv = document.createElement('div');
                            itemDiv.className = 'order-item';
                            
                            // Create image container
                            const imageContainer = document.createElement('div');
                            imageContainer.className = 'order-item-image';
                            
                            // Add loading spinner
                            const spinner = document.createElement('div');
                            spinner.className = 'image-loading';
                            spinner.innerHTML = '<div class="spinner-border spinner-border-sm text-secondary" role="status"></div>';
                            imageContainer.appendChild(spinner);
                            
                            // Create image element
                            const img = document.createElement('img');
                            img.alt = item.name || 'Product image';
                            img.style.display = 'none';
                            
                            // Get image URL and fetch image
                            const imageUrl = getProductImageUrl(item);
                            try {
                                const objectUrl = await fetchImage(imageUrl);
                                img.src = objectUrl;
                                img.style.display = 'block';
                                spinner.style.display = 'none';
                            } catch (error) {
                                console.error('Error loading image:', error);
                                img.src = 'https://www.sonatawatches.in/dw/image/v2/BKDD_PRD/on/demandware.static/-/Sites-sonata-master-catalog/default/dw3b590d6/images/placeholder.png';
                                img.style.display = 'block';
                                spinner.style.display = 'none';
                            }
                            
                            imageContainer.appendChild(img);
                            
                            // Create item details
                            const detailsDiv = document.createElement('div');
                            detailsDiv.className = 'order-item-details';
                            detailsDiv.innerHTML = `
                                <div class="order-item-name">${item.name || 'Product name not available'}</div>
                                <div class="order-item-quantity">Qty: ${item.quantity || 1}</div>
                                <div class="order-item-price">${formatCurrency(item.price * (item.quantity || 1))}</div>
                            `;
                            
                            itemDiv.appendChild(imageContainer);
                            itemDiv.appendChild(detailsDiv);
                            orderItems.appendChild(itemDiv);
                        } catch (error) {
                            console.error('Error displaying item:', error);
                            // Create fallback display
                            const fallbackDiv = document.createElement('div');
                            fallbackDiv.className = 'order-item';
                            fallbackDiv.innerHTML = `
                                <div class="order-item-image">
                                    <img src="https://www.sonatawatches.in/dw/image/v2/BKDD_PRD/on/demandware.static/-/Sites-sonata-master-catalog/default/dw3b590d6/images/placeholder.png" 
                                         alt="Product image">
                                </div>
                                <div class="order-item-details">
                                    <div class="order-item-name">${item.name || 'Product name not available'}</div>
                                    <div class="order-item-quantity">Qty: ${item.quantity || 1}</div>
                                    <div class="order-item-price">${formatCurrency(item.price * (item.quantity || 1))}</div>
                                </div>
                            `;
                            orderItems.appendChild(fallbackDiv);
                        }
                    }
                }
                
                // Update order summary
                if (orderData.summary) {
                    try {
                        document.getElementById('subtotal').textContent = formatCurrency(orderData.summary.subtotal || 0);
                        document.getElementById('shipping').textContent = orderData.summary.shipping === 0 ? 'Free' : formatCurrency(orderData.summary.shipping || 0);
                        document.getElementById('tax').textContent = formatCurrency(orderData.summary.tax || 0);
                        
                        if (orderData.summary.discount > 0) {
                            document.getElementById('promoDiscount').style.display = 'flex';
                            document.getElementById('discountAmount').textContent = `-${formatCurrency(orderData.summary.discount)}`;
                        }
                        
                        document.getElementById('total').textContent = formatCurrency(orderData.summary.total || 0);
                    } catch (error) {
                        handleError('Error displaying order summary.');
                    }
                }

                // Clean up image cache when leaving the page
                window.addEventListener('beforeunload', () => {
                    imageCache.forEach(url => URL.revokeObjectURL(url));
                    imageCache.clear();
                });

            } catch (error) {
                handleError('An unexpected error occurred while loading order details.');
                console.error('Order details error:', error);
            }
        }

        // Initialize page with error handling
        document.addEventListener('DOMContentLoaded', () => {
            try {
                updateOrderDetails();
                
                // Add download invoice button event listener
                const downloadBtn = document.querySelector('.btn-outline-dark');
                if (downloadBtn) {
                    downloadBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        try {
                            generateInvoice();
                        } catch (error) {
                            handleError('Error generating invoice. Please try again.');
                        }
                    });
                }
                
                // Clear all order data from localStorage
                localStorage.removeItem('orderData');
                localStorage.removeItem('checkoutFormData');
            } catch (error) {
                handleError('An error occurred while initializing the page.');
                console.error('Initialization error:', error);
            }
        });

        // Share buttons functionality with error handling
        document.querySelectorAll('.share-buttons .btn').forEach(button => {
            button.addEventListener('click', () => {
                try {
                    const platform = button.querySelector('i').classList[1].split('-')[1];
                    let shareUrl = '';
                    
                    switch(platform) {
                        case 'facebook':
                            shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}`;
                            break;
                        case 'twitter':
                            shareUrl = `https://twitter.com/intent/tweet?url=${encodeURIComponent(window.location.href)}&text=I just purchased from Sonata!`;
                            break;
                        case 'whatsapp':
                            shareUrl = `https://wa.me/?text=I just purchased from Sonata! ${encodeURIComponent(window.location.href)}`;
                            break;
                        case 'instagram':
                            shareUrl = 'https://www.instagram.com/sonatawatches/';
                            break;
                    }
                    
                    window.open(shareUrl, '_blank');
                } catch (error) {
                    handleError('Error sharing order details.');
                }
            });
        });
    </script>
</body>
</html> 